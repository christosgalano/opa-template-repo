# File: .azurepipelines/templates/format.yaml
#
# Description:
# This template is a series of steps that:
# 1. Installs the latest version of Regal and OPA.
# 2. Lints the rego files in the specified policy directory.
#
# Configuration of linter is done in the `.regal/config.yaml` configuration file.
# More information can be found at: https://docs.styra.com/regal/configuration
#

parameters:
  - name: policy_directory
    displayName: Policy Directory
    type: string
    default: policy

steps:
  - template: util/tools/opa/install.yaml@pipeline-library
    parameters:
      tools:
        - name: opa
          version: latest
        - name: regal
          version: latest

  - bash: regal lint ${{ parameters.policy_directory }}
    displayName: Lint rego files
